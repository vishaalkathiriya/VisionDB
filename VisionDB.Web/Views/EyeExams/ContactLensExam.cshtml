@using VisionDB.Helper
@model VisionDB.Models.EyeExam
@{
    ViewBag.Title = "Contact Lens Exam";
}

<h2>Contact Lens Exam for @Model.customer.ToString() - @string.Concat(@Model.TestDateAndTime.DayOfWeek.ToString(), " ", @Model.TestDateAndTime.ToShortDateString(), " ", @Model.TestDateAndTime.ToShortTimeString())</h2>
<br />
@using (Html.BeginForm())
{
    <text>Optician </text><div class="k-textbox large">@Html.DisplayTextFor(model => model.Optician.UserToString)</div>
    <br />
    <br />
    @(Html.Kendo().PanelBar()
          .Name("eyeExams")
          .ExpandMode(PanelBarExpandMode.Multiple)
          .Items(panelbar =>
          {
              panelbar.Add().Text("Contact Lens Information")
                  .Expanded(true)
                  .Content(@<text>
                    <br />
                    <table>
                        <tr>
                            <th width="50px" height="25px"></th>
                            <th width="100px">Sph</th>
                            <th width="100px">Cyl</th>
                            <th width="100px">Axis</th>
                            <th width="100px">VA</th>
                            <th width="110px">Over Reaction</th>
                            <th width="100px">Best VA</th>
                            <th width="240px">Type / Name</th>
                            <th width="100px">BC (BOZR)</th>
                            <th width="100px">TD</th>
                        </tr>
                        <tr>
                            <th height="50px">Right</th>
                            <td><div class="k-textbox small">@NumericHelper.GetSignedResult(Model.RSphericalDist)</div>@*rsphd*@</td>
                            <td><div class="k-textbox small">@NumericHelper.GetSignedResult(Model.RCylDist)</div>@*rcyld*@</td>
                            <td><div class="k-textbox small">@Model.RAxisDist</div>@*raxisd*@</td>
                            <td><div class="k-textbox small">@Model.SubRVA</div></td>
                            <td><div class="k-textbox small">@Model.CLOverReactionR</div></td>
                            <td><div class="k-textbox small">@Model.CLBestVaR</div></td>
                            <td><div class="k-textbox medium-field">@Html.DisplayWithBreaksFor(model => model.LensNameRight)</div></td>
                            <td><div class="k-textbox small">@NumericHelper.GetSignedResult(Model.CLBozrRight)</div></td>
                            <td><div class="k-textbox small">@NumericHelper.GetSignedResult(Model.CLTdRight)</div></td>
                        </tr>
                        <tr>
                            <th height="50px">Left</th>
                            <td><div class="k-textbox small">@NumericHelper.GetSignedResult(Model.LSphericalDist)</div>@*lsphd*@</td>
                            <td><div class="k-textbox small">@NumericHelper.GetSignedResult(Model.LCylDist)</div>@*lcyld*@</td>
                            <td><div class="k-textbox small">@Model.LAxisDist</div>@*laxisd*@</td>
                            <td><div class="k-textbox small">@Model.SubLVA</div></td>
                            <td><div class="k-textbox small">@Model.CLOverReactionL</div></td>
                            <td><div class="k-textbox small">@Model.CLBestVaL</div></td>
                            <td><div class="k-textbox medium-field">@Html.DisplayWithBreaksFor(model => model.LensNameLeft)</div></td>
                            <td><div class="k-textbox small">@NumericHelper.GetSignedResult(Model.CLBozrLeft)</div></td>
                            <td><div class="k-textbox small">@NumericHelper.GetSignedResult(Model.CLTdLeft)</div></td>
                        </tr>
                    </table>
                    <br />
                </text>);
              panelbar.Add().Text("Contact Lens Trial")

.Content(@<text>


                    <br />
                    <table>
                        <tr>
                            <th width="270px" height="25px">Right</th>
                            <th width="220px"></th>
                            <th>Left</th>
                        </tr>
                        <tr>
                            <td height="55px">
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.LensTypeRight)</div>
                            </td>
                            <th>Lens Type</th>
                            <td>
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.LensTypeLeft)</div>
                            </td>
                        </tr>
                        <tr>
                            <td height="55px">
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.SpecificationR)</div>
                            </td>
                            <th>Specification</th>
                            <td>
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.SpecificationL)</div>
                            </td>
                        </tr>
                        <tr>
                            <td height="55px">
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.FittingCentrationR)</div>
                            </td>
                            <th>Fitting / Centration</th>
                            <td>
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.FittingCentrationL)</div>
                            </td>
                        </tr>
                        <tr>
                            <td height="55px">
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.MovementR)</div>
                            </td>
                            <th>Movement</th>
                            <td>
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.MovementL)</div>
                            </td>
                        </tr>
                    </table>
                    <br />
</text>);
              panelbar.Add().Text("Slit Lamp / External Examination")

.Content(@<text>
                    <br />
                    <table>
                        <tr>
                            <th width="270px" height="25px">Right</th>
                            <th width="220px"></th>
                            <th>Left</th>

                        </tr>
                        <tr>
                            <td height="55px">
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.PupilDiameterR)</div>
                            </td>
                            <th>Pupil Diameter Vertical Aperture</th>
                            <td>
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.PupilDiameterL)</div>
                            </td>

                        </tr>
                        <tr>
                            <td height="55px">
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.UpperLidR)</div>
                            </td>
                            <th>Upper Lid</th>
                            <td>
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.UpperLidL)</div>
                            </td>

                        </tr>

                        <tr>
                            <td height="55px">
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.CorneaR)</div>
                            </td>
                            <th>Cornea</th>
                            <td>
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.CorneaL)</div>
                            </td>

                        </tr>
                        <tr>
                            <td height="55px">
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.LowerLidR)</div>
                            </td>
                            <th>Lower Lid</th>
                            <td>
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.LowerLidL)</div>
                            </td>

                        </tr>
                        <tr>
                            <td height="55px">
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.MeibomianGlandsR)</div>
                            </td>
                            <th>Meibomian Glands</th>
                            <td>
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.MeibomianGlandsL)</div>
                            </td>

                        </tr>
                        <tr>
                            <td height="55px">
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.LimbalAppearanceR)</div>
                            </td>
                            <th>Limbal Appearance</th>
                            <td>
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.LimbalAppearanceL)</div>
                            </td>

                        </tr>
                        <tr>
                            <td height="55px">
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.CounjunctivalAppaeranceR)</div>
                            </td>
                            <th>Counjunctival Appearance</th>
                            <td>
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.CounjunctivalAppaeranceL)</div>
                            </td>

                        </tr>
                        <tr>
                            <td height="55px">
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.TearQualityR)</div>
                            </td>
                            <th>Tear Quality</th>
                            <td>
                                <div class="k-textbox large">@Html.DisplayWithBreaksFor(model => model.TearQualityL)</div>
                            </td>

                        </tr>
                    </table>
                    <br />

</text>);
              panelbar.Add().Text("Lens Care and Handling")

.Content(@<text>
                    <br />
                    @Html.LabelFor(model => model.CLFitPreviousWearingDetails)
                    <br />
                    @Html.TextAreaFor(model => model.CLFitPreviousWearingDetails, 4, 1, new { @class = "k-textbox extra-large" })
                    @Html.ValidationMessageFor(model => model.CLFitPreviousWearingDetails)
                    <br />
                    <br />
                    @Html.LabelFor(model => model.CLFitType)
                    <br />
                    @Html.TextAreaFor(model => model.CLFitType, 4, 1, new { @class = "k-textbox extra-large" })
                    @Html.ValidationMessageFor(model => model.CLFitType)
                    <br />
                    <br />
                    @Html.LabelFor(model => model.CLFitSolutionsUsed)
                    <br />
                    @Html.TextAreaFor(model => model.CLFitSolutionsUsed, 4, 1, new { @class = "k-textbox extra-large" })
                    @Html.ValidationMessageFor(model => model.CLFitSolutionsUsed)
                    <br />
                    <br />
                    @Html.LabelFor(model => model.CleaningRegime)
                    <br />
                    @Html.TextAreaFor(model => model.CleaningRegime, 4, 1, new { @class = "k-textbox extra-large" })
                    @Html.ValidationMessageFor(model => model.CleaningRegime)
                    <br />
                    <br />
                    @Html.LabelFor(model => model.CLFitWearingTime)
                    <br />
                    @Html.TextAreaFor(model => model.CLFitWearingTime, 2, 1, new { @class = "k-textbox extra-large" })
                    @Html.ValidationMessageFor(model => model.CLFitWearingTime)
                    <br />
                    <br />
                    @Html.LabelFor(model => model.CLFitCurrentPreviousProblems)
                    <br />
                    @Html.TextAreaFor(model => model.CLFitCurrentPreviousProblems, 4, 1, new { @class = "k-textbox extra-large" })
                    @Html.ValidationMessageFor(model => model.CLFitCurrentPreviousProblems)
                    <br />
    </text>);
              panelbar.Add().Text("Symptoms and History")
                  .Content(@<text>
                    <br />
                    <table>
                        <tr>
                            <td width="150px" height="100px">
                                @Html.LabelFor(model => model.MEDS)
                            </td>
                            <td width="260px">
                                <div class="k-textbox medium-field">@Html.DisplayWithBreaksFor(model => model.MEDS)</div>
                            </td>
                            <td width="160px">
                                @Html.LabelFor(model => model.Allergies)
                            </td>
                            <td width="260px">
                                <div class="k-textbox medium-field">@Html.DisplayWithBreaksFor(model => model.Allergies)</div>
                            </td>
                            <td width="160px"></td>
                            <td width="260px"></td>
                        </tr>
                        <tr>
                            <td height="100px">
                                @Html.LabelFor(model => model.SymptomsAndHistory)
                            </td>
                            <td>
                                <div class="k-textbox medium-field">@Html.DisplayWithBreaksFor(model => model.SymptomsAndHistory)</div>
                            </td>
                            <td>
                                @Html.LabelFor(model => model.RFV)
                            </td>
                            <td>
                                <div class="k-textbox medium-field">@Html.DisplayWithBreaksFor(model => model.RFV)</div>
                            </td>
                            <td>
                                @Html.LabelFor(model => model.GH)
                            </td>
                            <td>
                                <div class="k-textbox medium-field">@Html.DisplayWithBreaksFor(model => model.GH)</div>
                            </td>
                        </tr>
                        <tr>
                            <td height="100px">
                                @Html.LabelFor(model => model.POH)
                            </td>
                            <td>
                                <div class="k-textbox medium-field">@Html.DisplayWithBreaksFor(model => model.POH)</div>
                            </td>
                            <td>
                                @Html.LabelFor(model => model.FH)
                            </td>
                            <td>
                                <div class="k-textbox medium-field">@Html.DisplayWithBreaksFor(model => model.FH)</div>
                            </td>
                            <td></td>
                            <td></td>
                        </tr>
                    </table>
                    <br />
                </text>);
          })
    )
    <br />
    <table>
        <tr>
            <td>
                @Html.LabelFor(model => model.PatientAdvice)
                <br />
                <div class="k-textbox extra-large">@Html.DisplayWithBreaksFor(model => model.PatientAdvice)</div>
            </td>
        </tr>
        <tr>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td>
                @Html.LabelFor(model => model.ProductRecommendations)
                <br />
                <div class="k-textbox extra-large">@Html.DisplayWithBreaksFor(model => model.ProductRecommendations)</div>
            </td>
        </tr>
        <tr>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td>
                @Html.CheckBoxFor(model => model.ReferralSent, new { @disabled = "disabled" }) &nbsp; @Html.LabelFor(model => model.ReferralSent)
            </td>
        </tr>
    </table>
    <br />
    <p>
        @if (Session["user"] != null 
            && (((VisionDB.Models.ApplicationUser)Session["user"]).VDBRoles.Contains(VisionDB.Models.Enums.UserRoles.Optician)
            || ((VisionDB.Models.ApplicationUser)Session["user"]).VDBRoles.Contains(VisionDB.Models.Enums.UserRoles.Locum))) 
        {
            <button class="k-button" type="button" value="Edit" onclick="location.href='@Url.Action("EditContactLensExam", "EyeExams", new { id = Model.Id })'">Edit Details</button> @:&nbsp;
            <button class="delete-button k-button" value="Delete">Delete</button> @:&nbsp;
        }
        <button class="k-button" type="button" value="Back" onclick="location.href='@Url.Action("Customer", "Customers", new { id = Model.customer.Id })'">Back to patient</button>
    </p>

    <script id="delete-confirmation" type="text/x-kendo-template">
        <p class="delete-message">Are you sure?</p>

        <button class="delete-confirm k-button">Delete</button> &nbsp;
        <a href="#" class="delete-cancel k-button">Cancel</a>
    </script>
}

<script>
    $(".delete-button").click(function (e) {
        e.preventDefault();

        var kendoWindow = $("<div />").kendoWindow({
            title: "Confirm",
            resizable: false,
            modal: true
        });

        kendoWindow.data("kendoWindow")
            .content($("#delete-confirmation").html())
            .center().open();

        kendoWindow
            .find(".delete-confirm,.delete-cancel")
                .click(function () {
                    if ($(this).hasClass("delete-confirm")) {
                        window.location.replace('/EyeExams/Delete/@Model.Id.ToString()');
                    }

                    kendoWindow.data("kendoWindow").close();
                })
                .end()
    });
</script>